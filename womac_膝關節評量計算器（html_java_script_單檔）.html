<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WOMAC è†é—œç¯€è©•é‡è¨ˆç®—å™¨</title>
  <style>
    /* ===== æ–°ç‰ˆè¦–è¦ºï¼šé«˜å°æ¯”ã€å¯è®€æ€§æ›´ä½³ã€è¡Œå‹•å‹å–„ ===== */
    :root {
      --bg: #0b1020;           /* æ·±è‰²èƒŒæ™¯ */
      --panel: #0f172a;        /* å¡ç‰‡èƒŒæ™¯ */
      --elev: #111827;         /* æå‡é¢ */
      --text: #e7ecf4;         /* ä¸»è¦æ–‡å­— */
      --muted: #9fb0c2;        /* æ¬¡è¦æ–‡å­— */
      --line: #1f2a3a;         /* é‚Šæ¡† */
      --ring: #7dd3fc;         /* ç„¦é» */
      --primary: #22d3ee;      /* ä¸»è¦å¼·èª¿ */
      --primary-ink: #062129;  /* ä¸»è¦æŒ‰éˆ•æ–‡å­— */
      --ok: #34d399;           /* æˆåŠŸ */
      --warn: #f59e0b;         /* è­¦ç¤º */
      --err: #f87171;          /* éŒ¯èª¤ */
      --chip: #0d1527;         /* é¸é …åº• */
      --chip-on: #0f2533;      /* é¸é … hover */
    }
    [data-theme="light"]:root{
      --bg:#f6f7fb; --panel:#ffffff; --elev:#ffffff; --text:#0d1321; --muted:#5b6a7a; --line:#e5e9f0; --ring:#0284c7; --primary:#06b6d4; --primary-ink:#05202a; --chip:#f1f5f9; --chip-on:#e2e8f0;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Noto Sans TC, Helvetica, Arial;
      color:var(--text); background: radial-gradient(900px 600px at 15% -10%, #142036, transparent), radial-gradient(900px 600px at 100% -10%, #0b3a4a, transparent), var(--bg);
    }
    .container{max-width:1100px;margin:0 auto;padding:20px}

    /* Header */
    header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg, rgba(5,9,20,.9), rgba(5,9,20,.55));backdrop-filter: blur(10px); border-bottom:1px solid var(--line)}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;padding:12px 0}
    .title{font-weight:800;letter-spacing:.4px}
    .subtitle{color:var(--muted);font-size:12px}
    .spacer{flex:1}

    .btn{appearance:none;border:1px solid var(--line);background:var(--chip);color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700;letter-spacing:.3px;transition:transform .06s ease, box-shadow .2s ease, border-color .2s ease}
    .btn:hover{border-color:var(--ring); box-shadow:0 10px 24px -14px rgba(125,211,252,.6)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(135deg, #0891b2, var(--primary));border:none;color:var(--primary-ink)}
    .btn.ghost{background:transparent;border:1px dashed var(--line);color:var(--muted)}
    .btn.switch{display:inline-flex;align-items:center;gap:8px}

    /* å®Œæˆåº¦æ¢ */
    .progress{height:8px;background:#0a1222;border:1px solid var(--line);border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0%;background:linear-gradient(90deg, #0ea5e9, #22d3ee);transition:width .3s ease}

    /* Layout */
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .card{grid-column:span 12;background:var(--panel);border:1px solid var(--line);border-radius:16px;overflow:hidden}
    .card h2{margin:0;padding:14px 16px;border-bottom:1px solid var(--line);font-size:16px;background:var(--elev)}
    .card .content{padding:14px 16px}
    @media (min-width: 900px){.col-6{grid-column:span 6}}

    /* å•é¡Œèˆ‡é¸é … */
    .q{padding:12px 0;border-bottom:1px dashed var(--line)}
    .q:last-child{border-bottom:none}
    .q-title{font-weight:700;margin-bottom:10px}
    .scale{display:grid;grid-template-columns:repeat(5,minmax(64px,1fr));gap:8px}
    .opt{position:relative;border:1px solid var(--line);background:var(--chip);padding:12px;border-radius:12px;text-align:center;cursor:pointer;user-select:none; font-weight:700}
    .opt .cap{display:block;font-size:12px;color:var(--muted);font-weight:500}
    input[type=radio]{position:absolute;opacity:0;pointer-events:none}
    input[type=radio]:focus + .opt{outline:2px solid var(--ring)}
    input[type=radio]:checked + .opt{outline:2px solid var(--ring); box-shadow:0 8px 22px -12px rgba(125,211,252,.7); background:var(--chip-on)}

    /* çµ±è¨ˆå€ */
    .results{display:grid;grid-template-columns:repeat(12,1fr);gap:12px;padding:14px 16px 18px}
    .stat{grid-column:span 12;background:var(--elev);border:1px solid var(--line);border-radius:12px;padding:12px 14px}
    .stat h3{margin:0 0 6px;font-size:13px;color:var(--muted)}
    .stat .val{font-size:28px;font-weight:900;letter-spacing:.4px}
    .stat.small .val{font-size:18px}
    @media (min-width:900px){.stat{grid-column:span 3}.stat.wide{grid-column:span 6}}

    .missing{outline:2px dashed var(--warn)}
    .note{color:var(--muted);font-size:12px}

    /* è¡Œå‹•è£ç½®åº•éƒ¨æ“ä½œåˆ— */
    .dock{position:sticky;bottom:0;z-index:9;background:linear-gradient(180deg, rgba(5,9,20,0), rgba(5,9,20,.9));padding:10px 0}
    .dock-inner{display:flex;gap:10px}
    .dock .btn{flex:1}

    footer{color:var(--muted);font-size:12px;text-align:center;padding:24px 8px 40px}
    .link{color:var(--primary);text-decoration:underline dotted;cursor:pointer}
  </style>
</head>
<body>
  <header>
    <div class="container toolbar">
      <div>
        <div class="title">WOMAC è†é—œç¯€è©•é‡è¨ˆç®—å™¨</div>
        <div class="subtitle">è‡ªæˆ‘è©•ä¼°ç‰ˆ Â· 0=æ²’æœ‰ â†’ 4=éå¸¸åš´é‡</div>
      </div>
      <div class="spacer"></div>
      <button class="btn switch" id="themeBtn" title="åˆ‡æ›æ·±/æ·ºè‰²">ğŸŒ“ åˆ‡æ›ä¸»é¡Œ</button>
      <button class="btn" id="saveBaselineBtn" title="å°‡ç›®å‰åˆ†æ•¸å­˜ç‚ºåŸºç·šï¼Œä¹‹å¾Œå¯æ¯”è¼ƒæ”¹å–„å¹…åº¦">å­˜ç‚ºåŸºç·š</button>
      <button class="btn primary" id="calcBtn" title="è¨ˆç®—ç•¶å‰åˆ†æ•¸">è¨ˆç®—åˆ†æ•¸</button>
      <button class="btn ghost" id="clearBtn">é‡è¨­</button>
    </div>
    <div class="container" style="padding-top:0;padding-bottom:12px">
      <div class="progress" aria-label="å®Œæˆåº¦"><div class="bar" id="progressBar"></div></div>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <section class="card col-6" id="painCard">
        <h2>A. ç–¼ç—›ï¼ˆPainï¼‰ Â· 5 é¡Œ</h2>
        <div class="content" id="pain"></div>
      </section>
      <section class="card col-6" id="stiffCard">
        <h2>B. åƒµç¡¬ï¼ˆStiffnessï¼‰ Â· 2 é¡Œ</h2>
        <div class="content" id="stiff"></div>
      </section>
      <section class="card" id="funcCard">
        <h2>C. åŠŸèƒ½é™åˆ¶ï¼ˆPhysical Functionï¼‰ Â· 17 é¡Œ</h2>
        <div class="content" id="func"></div>
      </section>

      <section class="card">
        <h2>çµæœ</h2>
        <div class="results" id="results">
          <div class="stat"><h3>ç–¼ç—›åˆ†æ•¸ï¼ˆ0â€“20ï¼‰</h3><div class="val" id="painVal">â€”</div><div class="note" id="painNorm"></div></div>
          <div class="stat"><h3>åƒµç¡¬åˆ†æ•¸ï¼ˆ0â€“8ï¼‰</h3><div class="val" id="stiffVal">â€”</div><div class="note" id="stiffNorm"></div></div>
          <div class="stat"><h3>åŠŸèƒ½åˆ†æ•¸ï¼ˆ0â€“68ï¼‰</h3><div class="val" id="funcVal">â€”</div><div class="note" id="funcNorm"></div></div>
          <div class="stat wide"><h3>WOMAC ç¸½åˆ†ï¼ˆ0â€“96ï¼Œè¶Šé«˜è¶Šå·®ï¼‰</h3><div class="val" id="totalVal">â€”</div><div class="note" id="totalNorm"></div></div>
          <div class="stat wide small"><h3>èˆ‡åŸºç·šæ¯”è¼ƒï¼ˆæ”¹å–„ç‡ %ï¼‰</h3><div class="val" id="improveVal">å°šæœªè¨­å®šåŸºç·š</div><div class="note">åŸºç·š = ç¬¬ä¸€æ¬¡å¡«å¯«æˆ–æ²»ç™‚/ä¿å¥é–‹å§‹å‰çš„åˆ†æ•¸</div></div>
        </div>
      </section>

      <section class="card">
        <h2>ä½¿ç”¨èªªæ˜</h2>
        <div class="content">
          <ul>
            <li>æ¯é¡Œ 0â€“4 åˆ†ï¼š0 æ²’æœ‰ Â· 1 è¼•å¾® Â· 2 ä¸­ç­‰ Â· 3 åš´é‡ Â· 4 éå¸¸åš´é‡ã€‚</li>
            <li>æ¨™æº–åŒ–ï¼ˆ0â€“100ï¼‰ï¼š=ï¼ˆåˆ†æ•¸ Ã· è©²ç¯„ç–‡æœ€å¤§åˆ†ï¼‰Ã— 100ï¼Œä¾¿æ–¼è¿½è¹¤è¶¨å‹¢ã€‚</li>
            <li>è‡¨åºŠä¸Šå¸¸ä»¥ <strong>â‰¥ 20%</strong> çš„ç¸½åˆ†ä¸‹é™è¦–ç‚ºã€Œæœ‰æ„ç¾©çš„æ”¹å–„ã€ã€‚</li>
            <li>è‹¥å‡ºç¾ç´…æ——ç—‡ç‹€ï¼ˆæ€¥æ€§è…«è„¹ã€ç†±ç—›ã€ç„¡æ³•è² é‡ã€æ´»å‹•åº¦åŠ‡é™ï¼‰ï¼Œè«‹ç«‹å³å°±é†«ã€‚</li>
          </ul>
        </div>
      </section>
    </div>

    <!-- è¡Œå‹•è£ç½®åº•éƒ¨æ“ä½œåˆ— -->
    <div class="dock">
      <div class="container dock-inner">
        <button class="btn" id="exportJson">åŒ¯å‡ºä½œç­”</button>
        <button class="btn" id="importJson">åŒ¯å…¥ä½œç­”</button>
        <button class="btn primary" id="calcBtn2">è¨ˆç®—</button>
      </div>
    </div>
  </main>

  <footer>
    ç‰ˆæœ¬ 2.0ï¼ˆå¼·åŒ–è¦–è¦ºèˆ‡å¯ç”¨æ€§ï¼‰ Â· æœ¬å·¥å…·åƒ…ä¾›è‡ªæˆ‘è¿½è¹¤ï¼Œä¸æ›¿ä»£å°ˆæ¥­é†«ç™‚å»ºè­°ã€‚
  </footer>

  <script>
    // ===== å•é¡Œé›† =====
    const QUESTIONS = {
      pain: [
        'èµ°å¹³åœ°æ™‚çš„è†éƒ¨ç–¼ç—›',
        'ä¸Šæˆ–ä¸‹æ¨“æ¢¯æ™‚çš„è†éƒ¨ç–¼ç—›',
        'å¤œé–“ï¼ˆèººä¸‹æˆ–ç¡è¦ºæ™‚ï¼‰çš„è†éƒ¨ç–¼ç—›',
        'åè‘—æˆ–èººè‘—æ™‚çš„è†éƒ¨ç–¼ç—›',
        'ç«™ç«‹æ™‚çš„è†éƒ¨ç–¼ç—›',
      ],
      stiffness: [
        'æ—©æ™¨èµ·åºŠå¾Œçš„è†éƒ¨åƒµç¡¬',
        'ç™½å¤©ä¹…åå¾Œå†æ¬¡æ´»å‹•æ™‚çš„åƒµç¡¬',
      ],
      function: [
        'ä¸‹æ¨“æ¢¯', 'ä¸Šæ¨“æ¢¯', 'é•·æ™‚é–“ç«™ç«‹', 'å½è…°è§¸åœ°', 'å¹³åœ°è¡Œèµ°', 'ä¸Šè»Šæˆ–ä¸‹è»Š',
        'åœ¨å•†åº—è³¼ç‰©', 'ç©¿è„«è¥ªå­', 'ä¸ŠåºŠæˆ–ä¸‹åºŠ', 'å¾æ²™ç™¼èµ·èº«', 'å¾é«˜è™•å–ç‰©', 'å¾åœ°ä¸Šæ‹¾ç‰©',
        'è¡Œèµ° 15 åˆ†é˜ä»¥ä¸Š', 'ç©¿è¶Šæˆ¿é–“', 'æ´—æ¾¡å¾Œæ“¦ä¹¾èº«é«”', 'åä¸‹æˆ–èµ·ç«‹', 'ä¸Šå»æ‰€'
      ]
    };

    const MAX = { pain: 20, stiffness: 8, function: 68, total: 96 };

    // ===== æ¸²æŸ“ =====
    function caption(v){ return ['æ²’æœ‰','è¼•å¾®','ä¸­ç­‰','åš´é‡','éå¸¸åš´é‡'][v] || '' }

    function rowTemplate(key, idx, label){
      const name = `${key}-${idx}`;
      return `
      <div class=\"q\">
        <div class=\"q-title\">${idx+1}. ${label}</div>
        <div class=\"scale\" role=\"radiogroup\" aria-labelledby=\"${name}-lab\">
          ${[0,1,2,3,4].map(v => `
            <label>
              <input type=\"radio\" name=\"${name}\" value=\"${v}\" aria-label=\"${v}\" />
              <div class=\"opt\">${v}<span class=\"cap\">${caption(v)}</span></div>
            </label>
          `).join('')}
        </div>
      </div>`
    }

    function renderSection(containerId, key){
      const el = document.getElementById(containerId);
      el.innerHTML = QUESTIONS[key].map((q,i)=>rowTemplate(key,i,q)).join('');
    }

    function renderAll(){
      renderSection('pain', 'pain');
      renderSection('stiff', 'stiffness');
      renderSection('func', 'function');
      attachChangeListeners();
      updateProgress();
    }

    // ===== è¨ˆåˆ† =====
    function getSectionScore(key){
      const n = QUESTIONS[key].length;
      let sum = 0; let missing = [];
      for(let i=0;i<n;i++){
        const name = `${key}-${i}`;
        const selected = document.querySelector(`input[name=\"${name}\"]:checked`);
        if(!selected){ missing.push(name); continue; }
        sum += Number(selected.value);
      }
      return { sum, missing };
    }

    function norm(val, max){ return Math.round((val / max) * 1000) / 10 }

    function highlightMissing(missing){
      document.querySelectorAll('.missing').forEach(el => el.classList.remove('missing'));
      missing.forEach(name => {
        const group = document.querySelector(`input[name=\"${name}\"]`)?.closest('.scale');
        if(group) group.classList.add('missing');
      });
      if(missing.length){
        const top = document.querySelector('.missing').getBoundingClientRect().top + window.pageYOffset - 120;
        window.scrollTo({ top, behavior:'smooth' });
      }
    }

    function calculate(){
      const p = getSectionScore('pain');
      const s = getSectionScore('stiffness');
      const f = getSectionScore('function');
      const missing = [...p.missing, ...s.missing, ...f.missing];
      highlightMissing(missing);
      if(missing.length) return;

      const total = p.sum + s.sum + f.sum;
      // é¡¯ç¤º
      setText('painVal', p.sum);
      setText('stiffVal', s.sum);
      setText('funcVal', f.sum);
      setText('totalVal', total);

      setText('painNorm', `æ¨™æº–åŒ–ï¼š${norm(p.sum, MAX.pain)} / 100`);
      setText('stiffNorm', `æ¨™æº–åŒ–ï¼š${norm(s.sum, MAX.stiffness)} / 100`);
      setText('funcNorm', `æ¨™æº–åŒ–ï¼š${norm(f.sum, MAX.function)} / 100`);
      setText('totalNorm', `æ¨™æº–åŒ–ï¼š${norm(total, MAX.total)} / 100`);

      // èˆ‡åŸºç·šæ¯”è¼ƒ
      const base = loadBaseline();
      const improveEl = document.getElementById('improveVal');
      if(base && typeof base.total === 'number' && base.total > 0){
        const diff = base.total - total; // åˆ†æ•¸ä¸‹é™ç‚ºæ­£å‘
        const rate = Math.round((diff / base.total) * 1000) / 10;
        const sign = rate > 0 ? 'æ”¹å–„' : (rate < 0 ? 'æƒ¡åŒ–' : 'ç„¡è®ŠåŒ–');
        improveEl.textContent = `${sign} ${rate}%ï¼ˆåŸºç·šï¼š${base.total}ï¼Œ${new Date(base.date).toLocaleDateString()}ï¼‰`;
        improveEl.style.color = rate >= 20 ? 'var(--ok)' : rate < 0 ? 'var(--err)' : 'var(--text)';
      } else {
        improveEl.textContent = 'å°šæœªè¨­å®šåŸºç·š';
        improveEl.style.color = 'var(--muted)';
      }
      return { p: p.sum, s: s.sum, f: f.sum, total };
    }

    function setText(id, val){ document.getElementById(id).textContent = String(val) }

    // ===== é€²åº¦æ¢ =====
    function totalQuestions(){
      return QUESTIONS.pain.length + QUESTIONS.stiffness.length + QUESTIONS.function.length;
    }
    function answeredCount(){
      return document.querySelectorAll('input[type=radio]:checked').length;
    }
    function updateProgress(){
      const pct = Math.round((answeredCount() / totalQuestions()) * 100);
      const bar = document.getElementById('progressBar');
      bar.style.width = pct + '%';
      bar.title = `å®Œæˆåº¦ ${pct}%`;
    }
    function attachChangeListeners(){
      document.querySelectorAll('input[type=radio]').forEach(r => r.addEventListener('change', updateProgress));
    }

    // ===== åŸºç·šå„²å­˜ / è¼‰å…¥ =====
    function saveBaseline(){
      const scores = calculate();
      if(!scores) { alert('è«‹å…ˆå®Œæˆæ‰€æœ‰é¡Œç›®ä¸¦æŒ‰ã€Œè¨ˆç®—åˆ†æ•¸ã€ã€‚'); return; }
      const payload = { ...scores, date: new Date().toISOString() };
      localStorage.setItem('womac_baseline', JSON.stringify(payload));
      alert('å·²å­˜ç‚ºåŸºç·šã€‚ä¸‹æ¬¡è¨ˆç®—å°‡é¡¯ç¤ºæ”¹å–„å¹…åº¦ã€‚');
    }
    function loadBaseline(){
      try { return JSON.parse(localStorage.getItem('womac_baseline')); } catch { return null; }
    }

    // ===== åŒ¯å‡º / åŒ¯å…¥ =====
    function exportJSON(){
      const answers = {};
      Object.keys(QUESTIONS).forEach(key => {
        answers[key] = QUESTIONS[key].map((_, idx) => {
          const name = `${key}-${idx}`;
          const sel = document.querySelector(`input[name=\"${name}\"]:checked`);
          return sel ? Number(sel.value) : null;
        });
      });
      const data = { answers, timestamp: new Date().toISOString() };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `WOMAC_answers_${Date.now()}.json`; a.click();
      URL.revokeObjectURL(url);
    }

    function importJSON(){
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'application/json';
      input.onchange = () => {
        const file = input.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const data = JSON.parse(reader.result);
            if(!data.answers) throw new Error('æ ¼å¼ä¸æ­£ç¢º');
            Object.keys(QUESTIONS).forEach(key => {
              (data.answers[key] || []).forEach((val, idx) => {
                const name = `${key}-${idx}`;
                if(val == null) return;
                const radio = document.querySelector(`input[name=\"${name}\"][value=\"${val}\"]`);
                if(radio) radio.checked = true;
              });
            });
            calculate(); updateProgress();
            alert('å·²åŒ¯å…¥ä½œç­”ã€‚');
          } catch(err){ alert('åŒ¯å…¥å¤±æ•—ï¼š' + err.message); }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    // ===== ä¸»é¡Œåˆ‡æ› =====
    function setTheme(mode){
      document.documentElement.setAttribute('data-theme', mode);
      localStorage.setItem('theme', mode);
    }
    function toggleTheme(){
      const current = document.documentElement.getAttribute('data-theme') || 'dark';
      setTheme(current === 'light' ? 'dark' : 'light');
    }
    function initTheme(){
      const saved = localStorage.getItem('theme');
      if(saved){ setTheme(saved); }
    }

    // ===== ç¶å®šäº‹ä»¶èˆ‡åˆå§‹åŒ– =====
    function bind(){
      document.getElementById('calcBtn').addEventListener('click', calculate);
      document.getElementById('calcBtn2').addEventListener('click', calculate);
      document.getElementById('saveBaselineBtn').addEventListener('click', saveBaseline);
      document.getElementById('clearBtn').addEventListener('click', () => { document.querySelectorAll('input[type=radio]').forEach(r=>r.checked=false); updateProgress(); document.querySelectorAll('.missing').forEach(el=>el.classList.remove('missing')); ['painVal','stiffVal','funcVal','totalVal','painNorm','stiffNorm','funcNorm','totalNorm'].forEach(id=>setText(id,'â€”')); const iv=document.getElementById('improveVal'); iv.textContent='å°šæœªè¨­å®šåŸºç·š'; iv.style.color='var(--muted)'; });
      document.getElementById('exportJson').addEventListener('click', exportJSON);
      document.getElementById('importJson').addEventListener('click', importJSON);
      document.getElementById('themeBtn').addEventListener('click', toggleTheme);
    }

    initTheme();
    renderAll();
    bind();
  </script>
</body>
</html>
